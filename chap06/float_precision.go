// 示例：浮点数精度问题
// 演示浮点数的舍入误差和精度损失

package main

import "fmt"

func main() {
	// ============================================
	// 1. 浮点数精度问题：1/3 的例子
	// ============================================
	fmt.Println("=== 浮点数精度问题：1/3 ===")
	
	// 理论上：1/3 + 1/3 + 1/3 = 1
	// 但实际上由于二进制表示的限制，会有精度损失
	
	oneThird := 1.0 / 3
	fmt.Printf("1/3 = %.15f\n", oneThird)
	
	// 三个 1/3 相加
	sum := oneThird + oneThird + oneThird
	fmt.Printf("1/3 + 1/3 + 1/3 = %.15f\n", sum)
	fmt.Printf("是否等于 1.0? %t\n", sum == 1.0)  // false
	
	// 用 %.1f 打印，会四舍五入显示为 1.0
	fmt.Printf("保留1位小数: %.1f\n", sum)  // 显示 1.0
	
	fmt.Println()
	
	// ============================================
	// 2. 舍入误差：0.1 + 0.2 的例子
	// ============================================
	fmt.Println("=== 舍入误差：0.1 + 0.2 ===")
	
	// 0.1 和 0.2 在二进制中都是无限循环小数
	// 计算机只能保留有限位，导致精度损失
	
	pinkBlack := 0.1
	pinkBlack += 0.2
	
	fmt.Printf("0.1 + 0.2 = %v\n", pinkBlack)
	fmt.Printf("0.1 + 0.2 = %.20f\n", pinkBlack)  // 显示更多小数位
	fmt.Printf("是否等于 0.3? %t\n", pinkBlack == 0.3)  // false
	
	// 用 %.1f 打印，会四舍五入显示为 0.3
	fmt.Printf("保留1位小数: %.1f\n", pinkBlack)  // 显示 0.3
	
	fmt.Println()
	
	// ============================================
	// 3. 避免显示误差：指定打印宽度
	// ============================================
	fmt.Println("=== 避免显示误差：指定打印宽度 ===")
	
	// 方法：使用 fmt.Printf 指定精确的小数位数
	// 这样会自动四舍五入，只显示需要的精度
	
	fmt.Printf("保留1位: %.1f\n", pinkBlack)  // 0.3
	fmt.Printf("保留2位: %.2f\n", pinkBlack)  // 0.30
	fmt.Printf("保留3位: %.3f\n", pinkBlack)  // 0.300
	
	// 注意：这只是显示层面的处理
	// 变量本身存储的还是 0.30000000000000004
	fmt.Printf("实际值: %.20f\n", pinkBlack)
	
	fmt.Println()
	
	// ============================================
	// 4. 计算技巧：乘法放在除法前面
	// ============================================
	fmt.Println("=== 计算技巧：先乘后除 ===")
	
	// 先乘后除：更精确
	a, b, c := 123456.0, 789.0, 10000.0
	
	// 先乘后除
	result1 := (a * b) / c
	fmt.Printf("先乘后除: %.10f\n", result1)
	
	// 先除后乘
	result2 := (a / c) * b
	fmt.Printf("先除后乘: %.10f\n", result2)
	
	// 对比精度
	fmt.Printf("精度差异: %.20f\n", result1-result2)
	
	fmt.Println()
	
	// ============================================
	// 5. 精度损失的原理
	// ============================================
	fmt.Println("=== 精度损失的原理 ===")
	
	fmt.Println("原因：")
	fmt.Println("1. 计算机用二进制表示浮点数")
	fmt.Println("2. 十进制小数（如 0.1）转二进制可能是无限循环")
	fmt.Println("3. 计算机只能保留有限位（float64 约 53 位有效数字）")
	fmt.Println("4. 导致舍入误差和精度损失")
	
	fmt.Println()
	fmt.Println("示例：")
	fmt.Println("0.1 在二进制中是无限循环的")
	fmt.Println("0.2 在二进制中也是无限循环的")
	fmt.Println("相加时误差会累积")
	fmt.Println("结果：0.30000000000000004")
}

